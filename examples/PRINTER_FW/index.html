<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATOM PRINTER</title>
    <style id="CSSstyle" data-color="#f8be00">
        * {
            font-family: sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
        }

        .body-container {
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .button-container {
            height: 80px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        button {
            background-color: #7c7c7c;
            box-shadow: 0px 1px 9px 2px #939393;
            color: white;
            width: 60%;
            height: 41px;
            border: none;
            border-radius: 30px;
            font-weight: bold;
        }

        .active {
            background-color: #0092ff;
            box-shadow: 0px 1px 9px 2px #6ac4fc;
        }

        .input-container,
        .wifi-container,
        .mqtt-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            flex: 1;
            margin-bottom: 10px;
        }

        .title-container {
            margin-top: 12px;
            display: flex;
            align-items: center;
        }

        .title-container svg {
            width: 35px;
            height: 100%;
            margin-right: 15px;
        }

        textarea {
            width: 80%;
            height: 100px;
            margin: 10px;
        }

        h2 {
            text-align: center;
            margin: 0;
            font-weight: 400;
        }

        select {
            color: rgb(168, 168, 168);
            width: 300px;
            height: 32px;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }

        .wifi-container input,
        .mqtt-container input {
            color: rgb(168, 168, 168);
            width: 295px;
            height: 25px;
            text-align: center;
            margin-top: 10px;
        }

        .note {
            text-align: center;
            font-size: 12px;
            padding: 0px 10px 0px 10px;
            margin-bottom: 0;
        }

        #cover {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #000000c2;
        }

        .cover-container {
            text-align: center;
            margin-top: 50%;
            color: white;
        }

        .cover-animation {
            width: 60px;
            height: 60px;
            animation: loading 1s infinite linear;
        }

        @keyframes loading {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="body-container">
        <div class="input-container">
            <div class="title-container">
                <svg t="1643339469201" class="icon" viewBox="0 0 1024 1024" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" p-id="7655" width="200" height="200">
                    <path
                        d="M857.8 715.7H170.1c-38.1 0-68.8-30.9-68.8-68.8v-283c0-38.1 30.9-68.8 68.8-68.8H858c38.1 0 68.8 30.9 68.8 68.8v282.8c0 38.1-30.9 69-69 69z"
                        fill="#CBE4FE" p-id="7656"></path>
                    <path
                        d="M856.7 670.1H171.2c-30.6 0-55.5-24.8-55.5-55.5V305.1c0-30.6 24.8-55.5 55.5-55.5h685.6c30.6 0 55.5 24.8 55.5 55.5v309.7c-0.1 30.5-24.9 55.3-55.6 55.3z"
                        fill="#FFFFFF" p-id="7657"></path>
                    <path
                        d="M856.7 685.7H171.2c-39.2 0-71.1-31.8-71.1-71.1V305.1c0-39.2 31.8-71.1 71.1-71.1h685.6c39.2 0 71.1 31.8 71.1 71.1v309.7c-0.1 39.1-31.9 70.9-71.2 70.9zM171.2 265.2c-22 0-39.9 17.9-39.9 39.9v309.7c0 22 17.9 39.9 39.9 39.9h685.6c22 0 39.9-17.9 39.9-39.9V305.1c0-22-17.9-39.9-39.9-39.9H171.2z"
                        fill="#1B81FC" p-id="7658"></path>
                    <path d="M171.7 638.5h684.8V860H171.7z" fill="#CBE4FE" p-id="7659"></path>
                    <path
                        d="M856.7 670.1H171.2c-30.6 0-55.5-24.8-55.5-55.5V513.8h796.5v100.8c0 30.7-24.8 55.5-55.5 55.5z"
                        fill="#CBE4FE" p-id="7660"></path>
                    <path
                        d="M856.7 685.7H171.2c-39.2 0-71.1-31.8-71.1-71.1V498.2h827.7v116.4c0 39.3-31.8 71.1-71.1 71.1zM131.3 529.4v85.2c0 22 17.9 39.9 39.9 39.9h685.6c22 0 39.9-17.9 39.9-39.9v-85.2H131.3z"
                        fill="#1B81FC" p-id="7661"></path>
                    <path d="M186.2 596.7h655.5V817H186.2z" fill="#FFFFFF" p-id="7662"></path>
                    <path d="M857.3 832.5H170.6V581.1h686.7v251.4z m-655.5-31.2h624.3v-189H201.8v189z" fill="#1B81FC"
                        p-id="7663"></path>
                    <path d="M186.2 185h655.5v63H186.2z" fill="#FFFFFF" p-id="7664"></path>
                    <path d="M857.3 263.4H170.6v-94.2h686.7v94.2z m-655.5-31.2h624.3v-31.8H201.8v31.8z" fill="#1B81FC"
                        p-id="7665"></path>
                    <path d="M239.4 611.6h549.1v158.5H239.4z" fill="#CBE4FE" p-id="7666"></path>
                    <path d="M233.5 349.1m-32.3 0a32.3 32.3 0 1 0 64.6 0 32.3 32.3 0 1 0-64.6 0Z" fill="#CBE4FE"
                        p-id="7667"></path>
                    <path
                        d="M233.5 397c-26.4 0-47.9-21.5-47.9-47.9s21.5-47.9 47.9-47.9 47.9 21.5 47.9 47.9c0 26.3-21.6 47.9-47.9 47.9z m0-64.6c-9.2 0-16.7 7.5-16.7 16.7s7.5 16.7 16.7 16.7 16.7-7.5 16.7-16.7-7.5-16.7-16.7-16.7z"
                        fill="#1B81FC" p-id="7668"></path>
                </svg>
                <h2>PRINTER INPUT</h2>
            </div>
            <textarea name="" id="text_input" cols="30" rows="10"></textarea>
            <div>
                <label><input name="print_type" type="radio" value="ASCII" oninput="changeType(this)"
                        checked=true />ASCII</label>
                <label><input name="print_type" type="radio" value="QRCODE" oninput="changeType(this)" />QRCODE</label>
                <label><input name="print_type" type="radio" value="BAR" oninput="changeType(this)" />BAR CODE</label>
                <input id="bmp_file" type="file" onchange="commitBMP()" style="display:none">
            </div>
            <div class="button-container">
                <button class="active" onclick="commitData()">
                    Print Info
                </button>
            </div>
            <!-- <button style="background-color: #14ced5;box-shadow: 0px 1px 9px 2px #25c5e7; display: block;" onclick="changeFile()">
                Print BMP
            </button> -->
        </div>
        <div>

        </div>
        <div class="wifi-container">
            <div class="title-container">
                <svg t="1643340115337" class="icon" viewBox="0 0 1122 1024" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" p-id="29285" width="200" height="200">
                    <path
                        d="M561.152 910.336c-7.68 0-25.088-13.824-53.248-41.984-27.648-28.16-41.472-45.568-41.472-53.248 0-12.288 11.776-22.528 35.84-30.72s43.52-12.8 59.392-12.8c15.872 0 35.328 4.096 59.392 12.8s35.84 18.432 35.84 30.72c0 7.68-13.824 25.6-41.472 53.248-29.184 28.16-46.592 41.984-54.272 41.984z"
                        fill="#1296DB" p-id="29286"></path>
                    <path
                        d="M715.264 755.712c-0.512 0-8.192-4.608-23.04-14.336-14.336-9.728-33.792-18.944-57.856-28.672-24.064-9.728-48.64-14.336-73.216-14.336-24.576 0-49.152 4.608-73.216 14.336-24.064 9.728-43.52 18.944-57.856 28.672-14.336 9.728-22.016 14.336-23.04 14.336-6.656 0-24.576-14.336-53.248-43.008s-43.008-46.08-43.008-53.248c0-5.12 2.048-9.216 5.632-13.312 29.696-29.184 67.072-52.224 112.128-69.12s89.088-25.088 133.12-25.088c44.032 0 88.064 8.192 133.12 25.088 45.056 16.896 82.432 39.936 112.128 69.12 3.584 3.584 5.632 8.192 5.632 13.312 0 6.656-14.336 24.576-43.008 53.248-29.696 28.672-47.104 43.008-54.272 43.008z"
                        fill="#19A3E0" p-id="29287"></path>
                    <path
                        d="M871.424 600.064c-4.096 0-8.704-1.536-13.312-4.608-51.712-39.936-99.84-69.632-143.872-88.064s-95.232-28.16-153.088-28.16c-32.256 0-65.024 4.096-97.28 12.8S402.944 510.464 378.88 522.24c-24.064 11.776-45.568 23.552-65.024 35.328s-34.304 22.016-45.056 30.208c-11.264 8.192-16.896 12.8-17.92 12.8-6.656 0-24.064-14.336-52.736-43.008s-43.008-46.08-43.008-53.248c0-4.608 2.048-8.704 5.632-12.8 50.176-50.176 111.104-89.088 182.784-117.248 71.68-27.648 143.872-41.472 217.088-41.472s145.408 13.824 217.088 41.472c71.68 27.648 132.608 67.072 182.784 117.248 3.584 3.584 5.632 8.192 5.632 12.8 0 6.656-14.336 24.576-43.008 53.248s-45.056 42.496-51.712 42.496z"
                        fill="#48B5E5" p-id="29288"></path>
                    <path
                        d="M1026.048 445.44c-4.096 0-8.192-1.536-12.8-5.12-68.096-59.904-138.752-104.96-212.48-135.168-73.216-30.208-153.6-45.568-240.128-45.568-87.04 0-166.912 15.36-240.128 45.568S176.64 380.416 108.544 440.32c-4.096 3.584-8.192 5.12-12.8 5.12-6.656 0-24.064-14.336-52.736-43.008S0 356.352 0 349.184c0-5.12 2.048-9.216 5.632-13.312C76.8 265.216 161.792 210.432 260.096 171.52s198.656-58.368 301.056-58.368 202.752 19.456 301.056 58.368 183.296 93.696 254.464 164.352c3.584 3.584 5.632 8.192 5.632 13.312 0 6.656-14.336 24.576-43.008 53.248-28.672 28.672-46.592 43.008-53.248 43.008z"
                        fill="#80D8FF" p-id="29289"></path>
                </svg>
                <h2>WIFI CONFIG</h2>
            </div>
            <select id="wifi_list">
                <option value="SCANING">SCANING....</option>
            </select>
            <input id="wifi_password" type="text" placeholder="PASSWORD">
            <div class="button-container">
                <button id="wifi_connect_btn" onclick="commitWifi()">
                    Connect WiFi !
                </button>
            </div>
        </div>
        <div class="mqtt-container">
            <div class="title-container">
                <svg t="1643340288145" class="icon" viewBox="0 0 1024 1024" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" p-id="31066" width="200" height="200">
                    <path
                        d="M891.0336 879.3088H134.6048c-11.3152 0-20.48-9.1648-20.48-20.48v-222.72h797.3376v222.72c0.0512 11.3152-9.1648 20.48-20.4288 20.48z"
                        fill="#DCEDFF" p-id="31067"></path>
                    <path
                        d="M891.0336 124.0576H134.6048c-25.3952 0-46.08 20.6848-46.08 46.08v688.64c0 25.3952 20.6848 46.08 46.08 46.08h756.3776c25.3952 0 46.08-20.6848 46.08-46.08V170.1376c0.0512-25.3952-20.6336-46.08-46.0288-46.08zM139.7248 418.4576h746.1376v192H139.7248v-192z m0-243.2h746.1376v192H139.7248v-192z m746.1888 678.4512H139.7248v-192h746.1376v192z"
                        fill="#5B90EF" p-id="31068"></path>
                    <path
                        d="M749.9776 267.9808m-31.3344 0a31.3344 31.3344 0 1 0 62.6688 0 31.3344 31.3344 0 1 0-62.6688 0Z"
                        fill="#6491F2" p-id="31069"></path>
                    <path
                        d="M749.9776 514.4576m-31.3344 0a31.3344 31.3344 0 1 0 62.6688 0 31.3344 31.3344 0 1 0-62.6688 0Z"
                        fill="#6491F2" p-id="31070"></path>
                    <path
                        d="M749.9776 757.7088m-31.3344 0a31.3344 31.3344 0 1 0 62.6688 0 31.3344 31.3344 0 1 0-62.6688 0Z"
                        fill="#6491F2" p-id="31071"></path>
                </svg>
                <h2>MQTT CONFIG</h2>
            </div>
            <p class="note">By default, it connects to UIFlow MQTT server (mqtt.m5stack.com). And subscribe topic to the
                Mac address of the device. You can also customize the connection to other MQTT servers.</p>
            <p id="topic"></p>
            <input id="mqtt_broker" type="text" value="mqtt.m5stack.com" placeholder="MQTT_BROKER">
            <input id="mqtt_port" type="text" value=1883 placeholder="MQTT_PORT">
            <input id="mqtt_id" type="text" placeholder="ID">
            <input id="mqtt_user" type="text" placeholder="USER">
            <input id="mqtt_password" type="text" placeholder="PASSWORD">
            <input id="mqtt_topic_info" type="text" placeholder="SUBSCRIBE TOPIC">
            <div class="button-container">
                <button id="mqtt_connect_btn" onclick="commitMQTT()">
                    Connect MQTT Broker !
                </button>
            </div>
        </div>
    </div>
    <div id="cover">
        <div class="cover-container">
            <svg class="cover-animation" t="1643250501823" class="icon" viewBox="0 0 1024 1024" version="1.1"
                xmlns="http://www.w3.org/2000/svg" p-id="2061" width="200" height="200">
                <path
                    d="M876.864 782.592c3.264 0 6.272-3.2 6.272-6.656 0-3.456-3.008-6.592-6.272-6.592-3.264 0-6.272 3.2-6.272 6.592 0 3.456 3.008 6.656 6.272 6.656z m-140.544 153.344c2.304 2.432 5.568 3.84 8.768 3.84a12.16 12.16 0 0 0 8.832-3.84 13.76 13.76 0 0 0 0-18.56 12.224 12.224 0 0 0-8.832-3.84 12.16 12.16 0 0 0-8.768 3.84 13.696 13.696 0 0 0 0 18.56zM552.32 1018.24c3.456 3.648 8.32 5.76 13.184 5.76a18.368 18.368 0 0 0 13.184-5.76 20.608 20.608 0 0 0 0-27.968 18.368 18.368 0 0 0-13.184-5.824 18.368 18.368 0 0 0-13.184 5.76 20.608 20.608 0 0 0 0 28.032z m-198.336-5.76c4.608 4.8 11.072 7.68 17.6 7.68a24.448 24.448 0 0 0 17.536-7.68 27.456 27.456 0 0 0 0-37.248 24.448 24.448 0 0 0-17.536-7.68 24.448 24.448 0 0 0-17.6 7.68 27.52 27.52 0 0 0 0 37.184z m-175.68-91.84c5.76 6.08 13.824 9.6 21.952 9.6a30.592 30.592 0 0 0 22.016-9.6 34.368 34.368 0 0 0 0-46.592 30.592 30.592 0 0 0-22.016-9.6 30.592 30.592 0 0 0-21.952 9.6 34.368 34.368 0 0 0 0 46.592z m-121.152-159.36c6.912 7.36 16.64 11.648 26.368 11.648a36.736 36.736 0 0 0 26.432-11.584 41.28 41.28 0 0 0 0-55.936 36.736 36.736 0 0 0-26.432-11.584 36.8 36.8 0 0 0-26.368 11.52 41.28 41.28 0 0 0 0 56zM12.736 564.672a42.88 42.88 0 0 0 30.784 13.44 42.88 42.88 0 0 0 30.784-13.44 48.128 48.128 0 0 0 0-65.216 42.88 42.88 0 0 0-30.72-13.44 42.88 42.88 0 0 0-30.848 13.44 48.128 48.128 0 0 0 0 65.216z m39.808-195.392a48.96 48.96 0 0 0 35.2 15.36 48.96 48.96 0 0 0 35.2-15.36 54.976 54.976 0 0 0 0-74.56 48.96 48.96 0 0 0-35.2-15.424 48.96 48.96 0 0 0-35.2 15.424 54.976 54.976 0 0 0 0 74.56zM168.32 212.48c10.368 11.008 24.96 17.408 39.68 17.408 14.592 0 29.184-6.4 39.552-17.408a61.888 61.888 0 0 0 0-83.84 55.104 55.104 0 0 0-39.616-17.408c-14.656 0-29.248 6.4-39.616 17.408a61.888 61.888 0 0 0 0 83.84zM337.344 124.8c11.52 12.16 27.712 19.264 43.968 19.264 16.256 0 32.448-7.04 43.968-19.264a68.672 68.672 0 0 0 0-93.184 61.248 61.248 0 0 0-43.968-19.264 61.248 61.248 0 0 0-43.968 19.264 68.736 68.736 0 0 0 0 93.184z m189.632-1.088c12.672 13.44 30.528 21.248 48.448 21.248s35.712-7.808 48.384-21.248a75.584 75.584 0 0 0 0-102.464A67.392 67.392 0 0 0 575.36 0c-17.92 0-35.776 7.808-48.448 21.248a75.584 75.584 0 0 0 0 102.464z m173.824 86.592c13.824 14.592 33.28 23.104 52.736 23.104 19.584 0 39.04-8.512 52.8-23.104a82.432 82.432 0 0 0 0-111.744 73.472 73.472 0 0 0-52.8-23.168c-19.52 0-38.912 8.512-52.736 23.168a82.432 82.432 0 0 0 0 111.744z m124.032 158.528c14.976 15.872 36.032 25.088 57.216 25.088 21.12 0 42.24-9.216 57.152-25.088a89.344 89.344 0 0 0 0-121.088 79.616 79.616 0 0 0-57.152-25.088c-21.184 0-42.24 9.216-57.216 25.088a89.344 89.344 0 0 0 0 121.088z m50.432 204.032c16.128 17.088 38.784 27.008 61.632 27.008 22.784 0 45.44-9.92 61.568-27.008a96.256 96.256 0 0 0 0-130.432 85.76 85.76 0 0 0-61.568-27.072c-22.848 0-45.44 9.984-61.632 27.072a96.192 96.192 0 0 0 0 130.432z"
                    fill="#0f92fc" p-id="2062"></path>
            </svg>
            <p id="note2">Config...</p>
            <p>If long time not response</p>
            <p>Pls check the information is correct</p>
        </div>
    </div>
    <script>

        var wifi_connected = false;
        var mqtt_connected = false;
        var type = "ASCII";

        var wifi_connect_btn = document.getElementById("wifi_connect_btn");
        var mqtt_connect_btn = document.getElementById("mqtt_connect_btn");
        var mqtt_topic = document.getElementById("topic");
        var note = document.getElementById("note2");
        var file = document.getElementById("bmp_file");

        function changeType(obj) {
            console.log(obj.value);
            type = obj.value;
        }

        function changeFile() {
            file.click();
        }

        function commitBMP() {
            var data = new FormData();
            var file_handle = file.files[0]
            console.log(file_handle)
            var reader = new FileReader();
            reader.onload = (ev) => {
                console.log(ev.target.result)
                var img = new Image();
                img.onload = (ev) => {
                    console.log(ev)
                    console.log(ev.path[0].width)
                    console.log(ev.path[0].height)

                    data.append("bmp_width", ev.path[0].width)
                    data.append("bmp_height", ev.path[0].height)
                    data.append("bmp_data", file.files[0])

                    data_json = JSON.stringify({
                        "bmp_width": ev.path[0].width,
                        "bmp_height": ev.path[0].height
                    })
                    if (window.XMLHttpRequest) {
                        httpRequest = new XMLHttpRequest()
                    } else if (window.ActiveXObject) {
                        httpRequest = new ActiveXObject()
                    }
                    console.log(data_json)
                    httpRequest.open("POST", "/bmp_size", true);
                    httpRequest.send(data_json);
                    if (window.XMLHttpRequest) {
                        httpRequest = new XMLHttpRequest()
                    } else if (window.ActiveXObject) {
                        httpRequest = new ActiveXObject()
                    }
                    console.log(data)
                    httpRequest.open("POST", "/bmp", true);
                    httpRequest.send(data);
                    file.value = '';

                }
                img.src = ev.target.result;
            }
            reader.readAsDataURL(file_handle)
        }

        function print_res_handle() {
            var data = httpRequest.responseText;
            console.log(data);
            document.getElementById("wifi_list").innerHTML = data;
        }

        function wifi_config_handle() {
            var data = httpRequest.responseText;
            console.log(data);
            if (data == "OK") {
                wifi_connect_btn.innerText = "WiFi Connected!";
                note.innerText = "MQTT connecing....";
                wifi_connect_btn.className = "active";
                wifi_connected = true;
            } else if (data == "ERROR") {
                wifi_connect_btn.innerText = "WiFi Connect Fail";
                setTimeout(() => {
                    wifi_connect_btn.innerText = "Connect WiFi !";
                }, 1500)
            }
            else {
                wifi_connect_btn.innerText = "Connecting...";
            }
            document.getElementById("cover").style.display = "none";
        }

        function mqtt_config_handle() {
            var data = httpRequest.responseText;
            console.log(data);
            if (data.indexOf("Subscribe Topic") != -1) {

                mqtt_connect_btn.innerText = "MQTT Connected!";
                mqtt_connect_btn.className = "active";
                mqtt_topic.innerText = data;
                mqtt_connected = true;
            } else if (data == "ERROR") {
                mqtt_connect_btn.innerText = "MQTT Connect Fail";
                setTimeout(() => {
                    mqtt_connect_btn.innerText = "Connect MQTT Broker !";
                }, 1500)
            }
            else {
                mqtt_connect_btn.innerText = "MQTT Connecting...";
            }
            document.getElementById("cover").style.display = "none";
        }

        function state_res_handle() {
            var data = httpRequest.responseText;
            console.log(data);
            var obj = JSON.parse(data);
            if (obj) {
                document.getElementById("wifi_list").innerHTML = obj["WIFI_HTML"];
                if (obj["WIFI_STATE"]) {
                    wifi_connect_btn.innerText = "WiFi Connected!";
                    wifi_connect_btn.className = "active";
                }
                if (obj["MQTT_STATE"]) {
                    mqtt_connect_btn.innerText = "MQTT Connected!";
                    mqtt_connect_btn.className = "active";
                    mqtt_topic.innerText = obj["MQTT_STATE"];
                }
            }
        }

        function commitData() {
            var data = document.getElementById('text_input').value;
            console.log(data);
            if (window.XMLHttpRequest) {
                httpRequest = new XMLHttpRequest()
            } else if (window.ActiveXObject) {
                httpRequest = new ActiveXObject()
            }
            data_json = JSON.stringify({
                "type": type,
                "payload": data
            })
            httpRequest.open("POST", "/print", true);
            httpRequest.send(data_json);
        }


        function commitWifi() {
            if (wifi_connected) {
                return "wifi_connected";
            }
            var ssid = document.getElementById('wifi_list').value;
            var pwd = document.getElementById('wifi_password').value;
            console.log(ssid);
            console.log(pwd);
            if (window.XMLHttpRequest) {
                httpRequest = new XMLHttpRequest()
            } else if (window.ActiveXObject) {
                httpRequest = new ActiveXObject()
            }
            var data_json = JSON.stringify({
                "ssid": ssid,
                "password": pwd
            })
            document.getElementById("cover").style.display = "block"
            httpRequest.open("POST", "/config", true);
            httpRequest.onreadystatechange = wifi_config_handle;
            httpRequest.send(data_json);
            note.innerText = "WiFi connecting....";
        }

        function commitMQTT() {
            if (mqtt_connected) {
                return "mqtt_connected";
            }
            var mqtt_broker = document.getElementById('mqtt_broker').value;
            var mqtt_port = document.getElementById('mqtt_port').value;
            var mqtt_id = document.getElementById('mqtt_id').value;
            var mqtt_user = document.getElementById('mqtt_user').value;
            var mqtt_password = document.getElementById('mqtt_password').value;
            var mqtt_topic_info = document.getElementById('mqtt_topic_info').value;
            console.log(mqtt_broker);
            console.log(mqtt_port);
            console.log(mqtt_id);
            console.log(mqtt_user);
            console.log(mqtt_password);
            console.log(mqtt_topic_info);
            if (window.XMLHttpRequest) {
                httpRequest = new XMLHttpRequest()
            } else if (window.ActiveXObject) {
                httpRequest = new ActiveXObject()
            }
            var data_json = JSON.stringify({
                "mqtt_broker": mqtt_broker,
                "mqtt_port": mqtt_port,
                "mqtt_id": mqtt_id,
                "mqtt_user": mqtt_user,
                "mqtt_password": mqtt_password,
                "mqtt_topic_info": mqtt_topic_info,
            })
            document.getElementById("cover").style.display = "block"
            httpRequest.open("POST", "/mqtt", true);
            httpRequest.onreadystatechange = mqtt_config_handle;
            httpRequest.send(data_json);
            note.innerText = "MQTT connecting....";
        }

        function getState() {
            if (window.XMLHttpRequest) {
                httpRequest = new XMLHttpRequest()
            } else if (window.ActiveXObject) {
                httpRequest = new ActiveXObject()
            }
            httpRequest.open("GET", "/state", true);
            httpRequest.onreadystatechange = state_res_handle;
            httpRequest.send();
        }
        getState();
    </script>
</body>

</html>